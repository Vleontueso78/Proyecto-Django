{% extends "finanzas/base.html" %}
{% load static %}
{% block title %}Detalle del dÃ­a{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/finanzas/finanzas_dashboard/global.css' %}">
<link rel="stylesheet" href="{% static 'css/finanzas/finanzas_dashboard/botones.css' %}">
<link rel="stylesheet" href="{% static 'css/finanzas/finanzas_dashboard/presupuesto.css' %}">
<link rel="stylesheet" href="{% static 'css/finanzas/finanzas_dashboard/fixes.css' %}">
{% endblock %}

{% block content %}
<div id="dashboard-container" class="fade-in">

    <h2 id="titulo-finanzas">ğŸ“† {{ fecha|date:"d/m/Y" }}</h2>

    <div class="card card-anim">

        {% if not registro.completado %}

        <div class="alert alert-warning center mb-6">
            âš  Este dÃ­a estÃ¡ pendiente. CompletÃ¡ los datos para poder cerrarlo.
        </div>

        <form method="post" class="dia-pendiente-form">
            {% csrf_token %}

            <!-- ================= PRESUPUESTO ================= -->
            <section class="dia-section">
                <h3 class="dia-section-title">ğŸ’° Presupuesto del dÃ­a</h3>

                <div class="center">
                    <div class="editable-field">
                        <input
                            id="presupuesto-input"
                            type="number"
                            name="para_gastar_dia"
                            class="editable-number"
                            step="0.01"
                            value="{{ registro.para_gastar_dia }}"
                            readonly
                        >

                        <div class="field-actions">
                            <button
                                type="button"
                                class="edit-btn"
                                data-target="presupuesto-input">âœ</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ================= GASTOS ================= -->
            <section class="dia-section">
                <h3 class="dia-section-title">ğŸ§¾ DistribuciÃ³n de gastos</h3>

                <div class="form-grid">

                    {% for item in campos_gastos %}
                    <div class="form-group editable-field">
                        <label>{{ item.icono }} {{ item.label }}</label>

                        <input
                            id="{{ item.campo }}-input"
                            type="number"
                            name="{{ item.campo }}"
                            step="0.01"
                            value="{{ item.valor }}"
                            class="editable-number {% if item.fijo %}input-locked{% endif %}"
                            {% if item.fijo %}readonly{% endif %}
                        >

                        <div class="field-actions">
                            <button
                                type="button"
                                class="edit-btn"
                                data-target="{{ item.campo }}-input"
                                {% if item.fijo %}disabled{% endif %}
                            >âœ</button>

                            <button
                                type="button"
                                class="lock-btn"
                                data-target="{{ item.campo }}-input"
                                title="{% if item.fijo %}Valor fijado{% else %}Fijar valor{% endif %}"
                            >
                                {% if item.fijo %}ğŸ”’{% else %}ğŸ”“{% endif %}
                            </button>
                        </div>
                    </div>
                    {% endfor %}

                </div>
            </section>

            <div class="center acciones-dia">
                <button type="submit" class="btn btn-accent">ğŸ’¾ Guardar dÃ­a</button>
                <a href="{% url 'finanzas:calendario_ver' %}" class="btn btn-ghost">â¬… Volver</a>
            </div>
        </form>

        {% else %}

        <!-- ================= DÃA COMPLETADO ================= -->

        <form method="post">
            {% csrf_token %}

            <div class="resumen-grid editable-group">

                <!-- Presupuesto -->
                <div class="editable-field">
                    <div class="muted">ğŸ’° Presupuesto</div>

                    <input
                        id="para_gastar_dia-completado"
                        type="number"
                        name="para_gastar_dia"
                        class="editable-number"
                        step="0.01"
                        value="{{ registro.para_gastar_dia }}"
                        readonly
                    >

                    <div class="field-actions">
                        <button
                            type="button"
                            class="edit-btn"
                            data-target="para_gastar_dia-completado">âœ</button>
                    </div>
                </div>

                {% for item in campos_gastos %}
                <div class="editable-field">
                    <div class="muted">{{ item.icono }} {{ item.label }}</div>

                    <input
                        id="{{ item.campo }}-completado"
                        type="number"
                        name="{{ item.campo }}"
                        class="editable-number {% if item.fijo %}input-locked{% endif %}"
                        step="0.01"
                        value="{{ item.valor }}"
                        {% if item.fijo %}readonly{% endif %}
                    >

                    <div class="field-actions">
                        <button
                            type="button"
                            class="edit-btn"
                            data-target="{{ item.campo }}-completado"
                            {% if item.fijo %}disabled{% endif %}
                        >âœ</button>

                        <button
                            type="button"
                            class="lock-btn"
                            data-target="{{ item.campo }}-completado"
                        >
                            {% if item.fijo %}ğŸ”’{% else %}ğŸ”“{% endif %}
                        </button>
                    </div>
                </div>
                {% endfor %}

            </div>

            <hr>

            <div class="resumen-grid">
                <div>
                    <div class="muted">ğŸ’¸ Gasto total</div>
                    <div class="resumen-valor">${{ registro.gasto_total }}</div>
                </div>
                <div>
                    <div class="muted">ğŸ“Š Balance diario</div>
                    <div class="resumen-valor">${{ registro.balance_diario }}</div>
                </div>
                <div>
                    <div class="muted">ğŸ’µ Sobrante efectivo</div>
                    <div class="resumen-valor">${{ registro.sobrante_efectivo }}</div>
                </div>
            </div>

            <div class="center acciones-dia">
                <button type="submit" class="btn btn-accent">ğŸ’¾ Guardar cambios</button>
                <a href="{% url 'finanzas:calendario_ver' %}" class="btn btn-ghost">â¬… Volver</a>
            </div>

        </form>
        {% endif %}
    </div>
</div>

<script src="{% static 'js/finanzas/completar_pendiente.js' %}"></script>
{% endblock %}